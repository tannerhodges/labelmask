/*! Labelmask - v0.1.0 - 2014-04-23
 * Inserts input-masking-style functionality into labels without disrupting the input itself.
 * Based on Politespace by Filament Group https://github.com/filamentgroup/politespace
 * Hacked apart by Brad Frost. Propert development welcome
 * MIT License */
(function(t){"use strict";var e=function(t){var r,a;if(!t)throw Error("Labelmask requires an element argument.");if(t.getAttribute){if(r=t.getAttribute("data-format").replace(/-/g,"_").toUpperCase(),!(r in e.Types))throw Error("Labelmask requires a format");this.element=t,this.elID=this.element.id,this.inputSeparator=e.Types[r].separator,this.inputFormat=e.Types[r].format,this.maxLength=e.Types[r].maxLength,this.inputGroupLength=""+e.Types[r].groupLength,this.adjustment=1===this.inputGroupLength.length?this.maxLength/+this.inputGroupLength:this.inputGroupLength.split(",").length-1,a=this._buildRegexArr(this.inputGroupLength),this.placeholder=e.preparePlaceholder(this),this.elLabel=$("[for="+this.elID+"]"),this.groupRegNonUniform=a.length>1,this.groupReg=RegExp(a.join(""),this.groupRegNonUniform?"":"g")}};e.prototype._buildRegexArr=function(t){var e,r,a,n;for(e=(""+t).split(","),r=[],a=0,n=e.length;n>a;a++)r.push("([\\S]{"+(""===e[a]?"1,":e[a])+"})"+(a>0?"?":""));return r},e.prototype.format=function(t){var e,r=t;if(this.groupRegNonUniform){if(e=r.match(this.groupReg)){e.shift();for(var a=0;e.length>a;a++)e[a]||(e.splice(a,1),a--)}r=(e||[r]).join(this.inputSeparator)}else r=r.replace(this.groupReg,"$1 ")," "===r.substr(r.length-1)&&(r=r.substr(0,r.length-1));return r},e.prototype.update=function(){var t=this.format(this.element.value);this.maxLength&&(t=t.substr(0,this.maxLength+this.adjustment)),this.element.value=t},e.prototype.unformat=function(t){return t.replace(RegExp(this.inputSeparator,"g"),"")},e.prototype.reset=function(){this.element.value=this.unformat(this.element.value)},e.prototype.addPlaceholder=function(){0===this.element.value.length&&(this.element.placeholder=this.placeholder)},e.prototype.addLabelMask=function(){0===this.elLabel.find(".labelmask").length&&this.elLabel.append($("<span>",{"class":"labelmask"}))},e.prototype.updateLabelMask=function(){var t=this.mask(),e=this.format(t);this.elLabel.find(".labelmask").html(" "+e)},e.prototype.removeLabelMask=function(){this.elLabel.find(".labelmask").remove()},e.prototype.mask=function(){var t=this.element.value.length,e=this.placeholder.replace(RegExp(this.inputSeparator,"g"),"").substr(t),r=this.element.value+e;return r},e.preparePlaceholder=function(t){var e=t.inputGroupLength.split(",");if(1===e.length){for(var r=t.inputGroupLength,a=[];r--;)a.push(Array(+e[0]+1).join(t.inputFormat));return a.join(t.inputSeparator)}return e.map(function(r){return+r>0?+r:e.reduce(function(t,e){return t-e},t.maxLength)}).map(function(e){return Array(++e).join(t.inputFormat)}).join(t.inputSeparator)},e.Types={CREDIT_CARD_NUMBER:{separator:" ",format:"x",groupLength:4,maxLength:16},US_TELEPHONE_NUMBER:{separator:"-",format:"_",groupLength:"3,3,",maxLength:10}},e.addInputType=function(t,r){t&&r.separator&&r.format&&r.groupLength&&r.total&&(e.Types[t]=r)},t.Labelmask=e})(this),function(t){"use strict";var e="labelmask",r="data-enhanced",a="[data-"+e+"]:not(["+r+"])";t.fn[e]=function(){return this.each(function(){var r=new Labelmask(this);r.addPlaceholder(),t(this).bind("blur",function(){r.reset(),r.update(),r.removeLabelMask()}).bind("focus",function(){r.reset(),r.addLabelMask(),r.updateLabelMask(t(this).val())}).bind("keyup",function(){r.updateLabelMask(t(this).val())}).data(e,r),r.update()})},t(document).bind("enhance",function(n){var i=t(n.target).is(a)?t(n.target):t(a,n.target);i[e]().attr(r,"true")})}(jQuery);